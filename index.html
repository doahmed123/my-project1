<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR GPS Interaction</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/ar.js/aframe/build/aframe-ar.min.js"></script>
    
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      #info-box {
        position: absolute;
        top: 50px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px;
        border-radius: 10px;
        display: none;
        z-index: 1000;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <div id="info-box"></div>

    <a-scene
      embedded
      arjs="sourceType: webcam; trackingMethod: gps; debugUIEnabled: false; videoTexture: true;"
      renderer="antialias: true; alpha: true;"
      vr-mode-ui="enabled: false;"
      device-orientation-permission-ui="enabled: true"
    >
      <!-- إضاءة لتحسين عرض المجسم -->
      <a-light type="ambient" intensity="0.8"></a-light>
      <a-light type="directional" intensity="1.2" position="1 2 1"></a-light>

      <!-- المجسم الأول -->
      <a-entity
        id="model1"
        gps-entity-place="latitude: 28.320675; longitude: 30.709236;"
        gltf-model="https://raw.githubusercontent.com/doahmed123/my-project1/main/the_great_pyramid_of_giza_egypt.glb"
        position="0 1 0"
        scale="0.4 0.4 0.4"
        rotation="0 0 0"
        class="clickable"
      ></a-entity>

      <!-- المجسم الثاني -->
      <a-entity
        id="model2"
        gps-entity-place="latitude: 28.320500; longitude: 30.709200;"
        gltf-model="https://raw.githubusercontent.com/doahmed123/my-project1/main/eiffel_tower_in_paris_france.glb"
        position="0 1 1"
        scale="0.2 0.2 0.2"
        rotation="0 0 0"
        class="clickable"
      ></a-entity>
    </a-scene>

    <script>
      const infoBox = document.getElementById("info-box");

      const models = [
        {
          id: "model1",
          name: "كليوباترا",
          description: "الملكة المصرية القديمة، القرن الأول قبل الميلاد.",
        },
        {
          id: "model2",
          name: "مجسم الهرم",
          description: "مجسم يظهر أهمية الهندسة المعمارية في الحضارة المصرية.",
        },
      ];

      models.forEach((modelData) => {
        const model = document.querySelector(`#${modelData.id}`);

        model.addEventListener("loaded", () => {
          model.addEventListener("click", () => {
            infoBox.innerHTML = `
              <strong>اسم المجسم:</strong> ${modelData.name}<br>
              <strong>الوصف:</strong> ${modelData.description}
            `;
            infoBox.style.display = "block";

            const utterance = new SpeechSynthesisUtterance(
              `اسم المجسم: ${modelData.name}. الوصف: ${modelData.description}.`
            );
            utterance.lang = "ar";
            speechSynthesis.speak(utterance);

            setTimeout(() => {
              infoBox.style.display = "none";
            }, 5000);
          });
        });
      });

      // دعم التحكم باللمس
      let isTouching = false;
      let previousTouchPosition = { x: 0, y: 0 };

      const updateRotation = (model, deltaX, deltaY) => {
        const rotation = model.getAttribute("rotation");
        model.setAttribute("rotation", {
          x: rotation.x + deltaY * 0.2,
          y: rotation.y + deltaX * 0.2,
          z: rotation.z,
        });
      };

      window.addEventListener("touchstart", (event) => {
        if (event.touches.length === 1) {
          isTouching = true;
          const touch = event.touches[0];
          previousTouchPosition = { x: touch.clientX, y: touch.clientY };
        }
      });

      window.addEventListener("touchmove", (event) => {
        if (isTouching && event.touches.length === 1) {
          const touch = event.touches[0];
          const deltaX = touch.clientX - previousTouchPosition.x;
          const deltaY = touch.clientY - previousTouchPosition.y;

          models.forEach(({ id }) => {
            const model = document.querySelector(`#${id}`);
            updateRotation(model, deltaX, deltaY);
          });

          previousTouchPosition = { x: touch.clientX, y: touch.clientY };
        }

        if (event.touches.length === 2) {
          const touch1 = event.touches[0];
          const touch2 = event.touches[1];

          const currentDistance = Math.sqrt(
            Math.pow(touch2.clientX - touch1.clientX, 2) +
              Math.pow(touch2.clientY - touch1.clientY, 2)
          );

          if (!window.initialDistance) {
            window.initialDistance = currentDistance;
            return;
          }

          const scaleChange = (currentDistance - window.initialDistance) * 0.005;

          models.forEach(({ id }) => {
            const model = document.querySelector(`#${id}`);
            const scale = model.getAttribute("scale");

            const newScale = {
              x: Math.max(0.1, scale.x + scaleChange),
              y: Math.max(0.1, scale.y + scaleChange),
              z: Math.max(0.1, scale.z + scaleChange),
            };

            model.setAttribute("scale", newScale);
          });

          window.initialDistance = currentDistance;
        }
      });

      window.addEventListener("touchend", () => {
        isTouching = false;
        window.initialDistance = null;
      });
    </script>
  </body>
</html>
